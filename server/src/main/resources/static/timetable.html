<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planner - ScheduleLynx</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="planner-page">
<!-- Navigation Bar (kept visible so user can exit planner) -->
<nav class="navbar">
    <div class="nav-container">
        <div class="logo">
            <h1>ScheduleLynx</h1>
        </div>
        <ul class="nav-menu">
            <li><a href="home.html" class="nav-link">Home</a></li>
            <li><a href="index.html" class="nav-link">Dashboard</a></li>
            <li><a href="timetable.html" class="nav-link active">Planner</a></li>
            <li><a href="features.html" class="nav-link">Features</a></li>
            <li><a href="#" onclick="logout()" class="nav-link logout-link">Logout</a></li>
        </ul>
    </div>
</nav>

<div class="planner-container container">
    <aside class="sidebar">
        <section class="panel">
            <h2>Add / Edit Task</h2>
            <form id="calItemForm" class="task-form">
                <div class="form-group">
                    <label for="calItemTitle">Title</label>
                    <input id="calItemTitle" name="title" type="text" placeholder="e.g., EECS lab" required/>
                </div>

                <div class="form-group">
                    <label for="taskType">Type</label>
                    <select id="taskType" name="type">
                        <option value="task">Task</option>
                        <option value="event">Event</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="date">Date (dueDate)</label>
                    <input id="date" name="date" type="date" required/>
                </div>

                <div id="startTimeGroup" class="form-group" style="display:none;">
                    <label for="startTime">Start Time</label>
                    <input id="startTime" name="startTime" type="time"/>
                </div>

                <div id="endTimeGroup" class="form-group" style="display:none;">
                    <label for="endTime">End Time</label>
                    <input id="endTime" name="endTime" type="time"/>
                </div>

                <div id="estimatedHoursGroup" class="form-group">
                    <label for="estimatedHours">Estimated Hours</label>
                    <input id="estimatedHours" name="estHours" type="number" min="0" step="0.5" value="1" required/>
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="desc" placeholder="Optional details..."></textarea>
                </div>

                <div id="recurringGroup" class="form-group">
                    <label><input id="isRecurring" name="isRecur" type="checkbox"/> Recurring</label>
                </div>

                <div id="recurrenceOptions" style="display:none;">
                    <div class="form-group">
                        <label for="recurrenceType">Recurrence</label>
                        <select id="recurrenceType" name="recurType">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="biweekly">Biweekly</option>
                        </select>
                    </div>

                    <div id="daysOfWeekGroup" class="form-group days-checkbox" style="display:none;">
                        <label><input name="isMon" type="checkbox" value="Mon"/> Mon</label>
                        <label><input name="isTue" type="checkbox" value="Tue"/> Tue</label>
                        <label><input name="isWed" type="checkbox" value="Wed"/> Wed</label>
                        <label><input name="isThu" type="checkbox" value="Thu"/> Thu</label>
                        <label><input name="isFri" type="checkbox" value="Fri"/> Fri</label>
                        <label><input name="isSat" type="checkbox" value="Sat"/> Sat</label>
                        <label><input name="isSun" type="checkbox" value="Sun"/> Sun</label>
                    </div>

                    <div class="form-group">
                        <label for="recurrenceEnd">Recurrence End Date</label>
                        <input id="recurrenceEnd" name="recurEnd" type="date"/>
                    </div>
                </div>

                <div class="form-buttons">
                    <button class="btn-primary" type="submit">Save Task</button>
                    <button class="btn-secondary" id="clearForm" type="button"
                            onclick="document.getElementById('taskForm').reset();
                            document.getElementById('recurrenceOptions').style.display='none';
                            document.getElementById('startTimeGroup').style.display='none';
                            document.getElementById('endTimeGroup').style.display='none';">
                        Reset
                    </button>
                </div>
            </form>
        </section>
    </aside>

    <main class="main-content">
        <div class="controls">
            <div class="control-buttons">
                <button class="btn-nav" id="prevWeek">◀ Prev</button>
                <div class="week-display" id="weekDisplay">Week</div>
                <button class="btn-nav" id="nextWeek">Next ▶</button>
            </div>
            <div class="control-actions">
                <button class="btn-primary" id="generateSchedule" disabled>Generate Schedule</button>
                <button class="btn-danger" id="clearAll">Clear All</button>
            </div>
        </div>

        <section class="tasks-panel">
            <h3>Your Tasks</h3>
            <div id="tasksList" class="tasks-list"></div>
        </section>

        <section class="schedule-section">
            <h3>This Week</h3>
            <div id="scheduleGrid" class="schedule-grid"></div>
        </section>

        <section class="timeline-section">
            <h3>Generated Timeline</h3>
            <div id="timeline"><p class="empty-state">Tasks will appear here once you add them and generate the
                schedule.</p></div>
        </section>
    </main>
</div>

<!-- Modal for task details -->
<div id="taskModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div id="modalBody"></div>
        <div class="modal-actions">
            <button id="editTaskBtn" class="btn-primary">Edit</button>
            <button id="deleteTaskBtn" class="btn-danger">Delete</button>
            <button id="closeModalBtn" class="btn-secondary">Close</button>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer">
    <div class="container">
        <p>&copy; 2026 ScheduleLynx. Your smart planner in sync.</p>
    </div>
</footer>

</body>
</html>

<script type="module" src="script.js"   ></script>
<script type="module" src="requests.js" ></script>
<script type="module" src="time.js"     ></script>
<script type="module">

    import { requestDeleteTask, postCalendarItem } from "./requests.js";
    import { editSelectedTask, loadDataFromServer } from "./script.js";
    import { dateToTime } from "./time.js";


    // Default Form Date and Times /////////////////////////////////////////////

    function setDefaultDate() {
        const today = new Date();
        const localDate = today.toLocaleDateString('en-CA');
        const dateInput = document.getElementById('date');
        dateInput.value = localDate;
    }
    setDefaultDate();

    function setDefaultStartTime() {
        const today = new Date();
        const startTimeInput = document.getElementById('startTime');
        startTimeInput.value = dateToTime(today);
    }
    setDefaultStartTime();

    function setDefaultEndTime() {
        const today = new Date();
        const endTimeInput = document.getElementById('endTime');
        endTimeInput.value = dateToTime(today, 60);
    }
    setDefaultEndTime();


    // Actions /////////////////////////////////////////////////////////////////

    // Calendar item form submission listener
    const calendarItemForm = document.getElementById("calItemForm");
    calendarItemForm.addEventListener("submit", async () => {

        const data = new FormData(calendarItemForm);
        const dataObject = Object.fromEntries(data);

        const success = await postCalendarItem(dataObject);
        if (success) await loadDataFromServer();
    });

    // Adds listeners when new task modals are added
    document.addEventListener("DOMContentLoaded", function() {

        const modal = document.getElementById("taskModal");

        if (modal) {
            const closeBtn = document.querySelector(".close-modal");
            const closeModalBtn = document.getElementById("closeModalBtn");
            const deleteTaskBtn = document.getElementById("deleteTaskBtn");
            const editTaskBtn = document.getElementById("editTaskBtn");

            closeBtn.addEventListener("click", () => modal.classList.remove("active"));
            closeModalBtn.addEventListener("click", () => modal.classList.remove("active"));

            window.addEventListener("click", (e) => {
                if (e.target === modal) {
                    modal.classList.remove("active");
                }
            });

            editTaskBtn.addEventListener("click", editSelectedTask);
            deleteTaskBtn.addEventListener("click", requestDeleteTask);
        }
    });

</script>